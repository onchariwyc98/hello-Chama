<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Hello Chama â€“ Onboarding</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css" rel="stylesheet">
<style>
body { font-family: "Roboto", sans-serif; background-color: #f8f9fa; margin:0; overflow-x:hidden; }
.navbar { background-color: #1e2a38; color:white; height:60px; position:fixed; top:0; left:0; right:0; z-index:1100; }
.navbar .navbar-brand { color:#00b894; font-weight:600; }
.sidebar-toggle { font-size:1.5rem; color:white; cursor:pointer; display:none; }
.layout { display:flex; margin-top:60px; min-height:calc(100vh - 60px); transition:all 0.3s; }
.sidebar { width:250px; background:white; border-right:1px solid #ddd; padding-top:1rem; position:sticky; top:60px; height:calc(100vh - 60px); overflow-y:auto; transition: transform 0.3s ease; }
.sidebar.collapsed { transform: translateX(-100%); }
.sidebar a { display:block; color:#333; padding:0.6rem 1rem; text-decoration:none; font-weight:500; border-radius:6px; margin:0.2rem 0; transition: all 0.2s; }
.sidebar a:hover { background:#e8f8f5; color:#00b894; }
.sidebar a.active { background:#00b894; color:white; }
.content { flex:1; padding:2rem; background-color:#f8f9fa; overflow-y:auto; }
.profile-pic { width:36px; height:36px; border-radius:50%; object-fit:cover; border:2px solid #00b894; }
.notification-badge { position:absolute; top:0; right:0; background:red; color:white; font-size:0.6rem; border-radius:50%; width:15px; height:15px; display:flex; align-items:center; justify-content:center; }
.progress { height:10px; border-radius:5px; margin-bottom:1rem; }
.progress-bar { transition: width 0.5s; }
@media(max-width:992px){ 
    .layout{flex-direction:column;} 
    .sidebar{position:fixed;top:60px;left:0;height:calc(100vh - 60px);z-index:1200;} 
    .sidebar-toggle{display:block;} 
    .content{padding:1rem;} 
}
</style>
</head>
<body>

<!-- Navbar -->
<nav class="navbar navbar-expand-lg px-3 d-flex align-items-center">
  <span class="sidebar-toggle me-3"><i class="bi bi-list"></i></span>
  <a class="navbar-brand" href="#">Hello Chama</a>
  <div class="ms-auto d-flex align-items-center gap-3">
    <div class="position-relative"><i class="bi bi-bell fs-5 text-white"></i><span class="notification-badge">3</span></div>
    <div class="position-relative"><i class="bi bi-envelope fs-5 text-white"></i><span class="notification-badge">2</span></div>
    <div class="dropdown">
      <a href="#" class="d-flex align-items-center text-white text-decoration-none dropdown-toggle" data-bs-toggle="dropdown">
        <img src="../img/profile1.jpg" alt="Profile" class="profile-pic me-2">
        <span id="welcomeName"></span>
      </a>
      <ul class="dropdown-menu dropdown-menu-end shadow">
        <li><a class="dropdown-item" href="#" id="profileBtn"><i class="bi bi-person me-2"></i>Profile</a></li>
        <li><a class="dropdown-item" href="#" id="logoutBtn"><i class="bi bi-box-arrow-right me-2"></i>Logout</a></li>
      </ul>
    </div>
  </div>
</nav>

<!-- Layout -->
<div class="layout">
  <div class="sidebar" id="sidebarMenu">
    <a href="#" class="active" data-page="dashboard"><i class="bi bi-speedometer2 me-2"></i>Dashboard</a>
    <a href="#" data-page="group"><i class="bi bi-people-fill me-2"></i>Group Setup</a>
    <a href="#" data-page="modules"><i class="bi bi-layers-fill me-2"></i>Modules Setup</a>
    <a href="#" data-page="billing"><i class="bi bi-credit-card-2-front-fill me-2"></i>Billing</a>
    <a href="#" data-page="terms"><i class="bi bi-file-earmark-text-fill me-2"></i>Terms</a>
  </div>

  <main class="content" id="mainContent">
    <h3 class="fw-bold text-success mb-3"><i class="bi bi-speedometer2 me-2"></i>Welcome, <span id="userNameDisplay">User</span>!</h3>
    <div class="progress">
      <div id="stepProgressBar" class="progress-bar bg-info" role="progressbar" style="width:0%;"></div>
    </div>

    <div class="alert alert-info" id="getStartedContainer">
      <p>Minimum steps to get started:</p>
      <ul>
        <li>Create and update your <strong>profile</strong>.</li>
        <li>Set up your first <strong>group</strong>.</li>
        <li>Optionally, configure basic <strong>modules</strong>.</li>
      </ul>
      <button id="getStartedBtn" class="btn btn-success mt-2"><i class="bi bi-play-fill me-2"></i>Get Started</button>
    </div>

    <div id="contentContainer" class="mt-4"></div>
  </main>
</div>

<!-- Bootstrap JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

<!-- Onboarding JS -->
<script>
const getStartedBtn = document.getElementById("getStartedBtn");
const getStartedContainer = document.getElementById("getStartedContainer");
const contentContainer = document.getElementById("contentContainer");
const stepProgressBar = document.getElementById("stepProgressBar");
const sidebar = document.getElementById("sidebarMenu");
const toggleBtn = document.querySelector(".sidebar-toggle");

let onboardingData = {
    group: {},
    activities: [],
    subModules: {},
    billing: "Trial",
    termsAccepted: false
};

// Sidebar mobile behavior
if (window.innerWidth <= 992) sidebar.classList.add("collapsed");

toggleBtn.addEventListener("click", () => sidebar.classList.toggle("collapsed"));
document.addEventListener("click", function(e) {
    if (window.innerWidth <= 992) {
        const isClickInside = sidebar.contains(e.target) || toggleBtn.contains(e.target);
        if (!isClickInside) sidebar.classList.add("collapsed");
    }
});
window.addEventListener("resize", () => {
    if (window.innerWidth <= 992) sidebar.classList.add("collapsed");
    else sidebar.classList.remove("collapsed");
});

// Load each step
function loadStep(stepFile, stepNum){
    getStartedContainer.style.display = 'none';
    fetch(stepFile)
        .then(r => {
            if(!r.ok) throw new Error(`${stepFile} not found`);
            return r.text();
        })
        .then(html => {
            contentContainer.innerHTML = html;
            if(stepProgressBar) {
                stepProgressBar.style.width = `${stepNum*20}%`;
                stepProgressBar.className = 'progress-bar ' + (stepNum<4?'bg-info':(stepNum<5?'bg-warning':'bg-success'));
            }
            attachHandlers(stepFile, stepNum);
        })
        .catch(err => contentContainer.innerHTML = `<p class="text-danger">${err.message}</p>`);
}

// Attach handlers dynamically
function attachHandlers(stepFile, stepNum){
    if(stepFile === 'step1_group.html'){
        const form = document.getElementById("groupForm");
        form.addEventListener('submit', e=>{
            e.preventDefault();
            onboardingData.group = {
                name: document.getElementById("groupName").value,
                description: document.getElementById("groupDescription").value
            };
            loadStep('step2_activities.html', 2);
        });
    }
    if(stepFile === 'step2_activities.html'){
        const form = document.getElementById("activitiesForm");
        form.addEventListener('submit', e=>{
            e.preventDefault();
            const checked = [...form.querySelectorAll('input[type="checkbox"]:checked')].map(c=>c.value);
            if(!checked.length){ alert('Select at least one activity'); return; }
            onboardingData.activities = checked;
            loadStep('step3_billing.html',3);
        });
    }
    if(stepFile === 'step3_billing.html'){
        const form = document.getElementById("billingForm");
        form.addEventListener('submit', e=>{
            e.preventDefault();
            const billing = form.querySelector('input[name="billing"]:checked').value;
            onboardingData.billing = billing;
            loadStep('step4_terms.html',4);
        });
    }
    if(stepFile === 'step4_terms.html'){
        const form = document.getElementById("termsForm");
        form.addEventListener('submit', e=>{
            e.preventDefault();
            if(!document.getElementById('acceptTerms').checked){ alert('Accept terms to continue'); return; }
            onboardingData.termsAccepted = true;
            loadStep('step5_welcome.html',5);
        });
    }
    if(stepFile === 'step5_welcome.html'){
        const startBtn = document.getElementById("startAppBtn");
        startBtn.addEventListener('click', ()=>{
            window.location.href = "../group_app/group_home.html";
        });
    }
}

// Start onboarding
getStartedBtn.addEventListener('click', ()=>loadStep('step1_group.html',1));
</script>
</body>
</html>
