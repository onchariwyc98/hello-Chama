<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Hello Chama â€“ Dashboard</title>

<!-- Bootstrap & Icons -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css" rel="stylesheet">

<style>
  body { font-family: "Roboto", sans-serif; background-color: #f5f5f5; margin: 0; }

  /* Navbar */
  .navbar { background-color: #1976d2; color: white; height: 60px; position: fixed; top: 0; left: 0; right: 0; z-index: 1100; }
  .navbar .navbar-brand { color: #fff; font-weight: 600; }
  .sidebar-toggle { font-size: 1.5rem; color: white; cursor: pointer; display: none; }

  /* Layout */
  .layout { display: flex; margin-top: 60px; min-height: calc(100vh - 60px); transition: all 0.3s; }

  /* Sidebar */
  .sidebar { width: 250px; background: #fff; border-right: 1px solid #ddd; padding-top: 1rem; position: sticky; top: 60px; height: calc(100vh - 60px); overflow-y: auto; transition: transform 0.3s ease; }
  .sidebar.collapsed { transform: translateX(-100%); }
  .sidebar a { display: flex; align-items: center; color: #333; padding: 0.8rem 1rem; text-decoration: none; font-weight: 500; border-radius: 8px; margin: 0.3rem 0; transition: all 0.2s; }
  .sidebar a:hover { background: #e3f2fd; color: #1976d2; }
  .sidebar a.active { background: #1976d2; color: white; }

  /* Content */
  .content { flex: 1; padding: 2rem; overflow-y: auto; }

  /* Profile Picture */
  .profile-pic { width: 36px; height: 36px; border-radius: 50%; object-fit: cover; border: 2px solid #fff; }

  /* Notification badges */
  .notification-badge { position: absolute; top: 0; right: 0; background: red; color: white; font-size: 0.6rem; border-radius: 50%; width: 15px; height: 15px; display: flex; align-items: center; justify-content: center; }

  /* Progress bar */
  .progress { height: 12px; border-radius: 10px; margin-bottom: 1rem; }
  .progress-bar { transition: width 0.5s; }

  /* Material-style cards */
  .card { border-radius: 12px; box-shadow: 0 3px 10px rgba(0,0,0,0.1); }

  /* Responsive */
  @media (max-width: 992px) {
    .layout { flex-direction: column; }
    .sidebar { position: fixed; top: 60px; left: 0; height: calc(100vh - 60px); z-index: 1200; width: 80%; max-width: 300px; }
    .sidebar-toggle { display: block; }
    .content { padding: 1rem; }
  }
</style>
</head>
<body>

<header>
  <!-- Navbar -->
  <nav class="navbar navbar-expand-lg px-3 d-flex align-items-center">
    <span class="sidebar-toggle me-3"><i class="bi bi-list"></i></span>
    <a class="navbar-brand" href="#">Hello Chama</a>
    <div class="ms-auto d-flex align-items-center gap-3">
      <div class="position-relative"><i class="bi bi-bell fs-5 text-white"></i><span class="notification-badge">3</span></div>
      <div class="position-relative"><i class="bi bi-envelope fs-5 text-white"></i><span class="notification-badge">2</span></div>
      <div class="dropdown">
        <a href="#" class="d-flex align-items-center text-white text-decoration-none dropdown-toggle" data-bs-toggle="dropdown">
          <img src="../img/profile1.jpg" alt="Profile" class="profile-pic me-2">
          <span id="welcomeName"></span>
        </a>
        <ul class="dropdown-menu dropdown-menu-end shadow">
          <li><a class="dropdown-item" href="#" id="profileBtn"><i class="bi bi-person me-2"></i>Profile</a></li>
          <li><a class="dropdown-item" href="#" id="logoutBtn"><i class="bi bi-box-arrow-right me-2"></i>Logout</a></li>
        </ul>
      </div>
    </div>
  </nav>
</header>

<section class="layout">
  <!-- Sidebar -->
  <aside class="sidebar" id="sidebarMenu">
    <a href="#" class="active" data-page="dashboard"><i class="bi bi-speedometer2 me-2"></i>Dashboard</a>
    <a href="#" data-page="group"><i class="bi bi-people-fill me-2"></i>Group Setup</a>
    <a href="#" data-page="modules"><i class="bi bi-layers-fill me-2"></i>Modules Setup</a>
    <a href="#" data-page="billing"><i class="bi bi-credit-card-2-front-fill me-2"></i>Billing</a>
    <a href="#" data-page="terms"><i class="bi bi-file-earmark-text-fill me-2"></i>Terms</a>
  </aside>

  <!-- Content -->
  <main class="content" id="mainContent">
    <div class="card p-3 mb-3">
      <h3 class="fw-bold text-primary mb-3"><i class="bi bi-speedometer2 me-2"></i>Welcome, <span id="userNameDisplay">User</span>!</h3>

      <div class="progress">
        <div id="stepProgressBar" class="progress-bar bg-info" role="progressbar" style="width:0%;"></div>
      </div>

      <div id="onboardingIntro" class="alert alert-primary">
        <p>Minimum steps to get started:</p>
        <ul>
          <li>Create and update your <strong>profile</strong>.</li>
          <li>Set up your first <strong>group</strong>.</li>
          <li>Optionally configure <strong>modules</strong>.</li>
        </ul>
        <button id="getStartedBtn" class="btn btn-primary mt-2"><i class="bi bi-play-fill me-2"></i>Get Started</button>
      </div>

      <div id="contentContainer" class="mt-4"></div>
    </div>
  </main>
</section>

<!-- Bootstrap JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

<script>
const sidebar = document.getElementById("sidebarMenu");
const content = document.getElementById("mainContent");
const toggleBtn = document.querySelector(".sidebar-toggle");
const welcomeName = document.getElementById("welcomeName");
const userNameDisplay = document.getElementById("userNameDisplay");
const navLinks = sidebar.querySelectorAll('a[data-page]');
const onboardingIntro = document.getElementById("onboardingIntro");
const contentContainer = document.getElementById("contentContainer");
const stepProgressBar = document.getElementById("stepProgressBar");
const getStartedBtn = document.getElementById("getStartedBtn");

// Load username
const username = sessionStorage.getItem("username") || "User";
welcomeName.textContent = `Hi, ${username}`;
userNameDisplay.textContent = sessionStorage.getItem("fullName") || "User";

// Sidebar toggle
if(window.innerWidth <= 992) sidebar.classList.add("collapsed");
toggleBtn.addEventListener("click", ()=>sidebar.classList.toggle("collapsed"));
window.addEventListener("resize", ()=>{ 
  if(window.innerWidth<=992) sidebar.classList.add("collapsed"); 
  else sidebar.classList.remove("collapsed"); 
});

// Sidebar nav links
navLinks.forEach(link=>{
  link.addEventListener('click', e=>{
    e.preventDefault();
    navLinks.forEach(l=>l.classList.remove('active'));
    link.classList.add('active');
    loadPage(link.dataset.page);
    if(window.innerWidth<=992) sidebar.classList.add("collapsed");
  });
});

// Profile & Logout
document.getElementById("profileBtn").addEventListener("click", e=>{ e.preventDefault(); loadPage("profile_management"); if(window.innerWidth<=992) sidebar.classList.add("collapsed"); });
document.getElementById("logoutBtn").addEventListener("click", e=>{ e.preventDefault(); sessionStorage.clear(); localStorage.clear(); window.location.href="../index.html"; });

// Load dashboard content
function loadPage(page){
  fetch(`${page}.html`).then(r=>r.text()).then(html=>content.innerHTML=html).catch(()=>content.innerHTML=`<p class="text-danger">Failed to load ${page}.html</p>`);
}

// ------------------- ONBOARDING FLOW -------------------
const onboardingData = { group:{}, activities:[], billing:"Trial", termsAccepted:false };
const pages = {
  group: ()=>`
    <h4 class="fw-bold text-primary mb-3">Step 1: Set Up Your First Group</h4>
    <form id="groupForm" class="row g-3">
      <div class="col-md-6">
        <label class="form-label">Group Name</label>
        <input type="text" class="form-control" id="groupName" value="${onboardingData.group.name||''}" required>
      </div>
      <div class="col-md-6">
        <label class="form-label">Group Type</label>
        <select id="groupType" class="form-select">
          <option ${onboardingData.group.type==='Savings'?'selected':''} value="Savings">Savings</option>
          <option ${onboardingData.group.type==='Welfare'?'selected':''} value="Welfare">Welfare</option>
          <option ${onboardingData.group.type==='Investment'?'selected':''} value="Investment">Investment</option>
          <option ${onboardingData.group.type==='Loans'?'selected':''} value="Loans">Loans</option>
          <option ${onboardingData.group.type==='MerryGoRound'?'selected':''} value="Merry-Go-Round">Merry-Go-Round</option>
        </select>
      </div>
      <div class="col-md-6">
        <label class="form-label">Start Date</label>
        <input type="date" class="form-control" id="groupStartDate" value="${onboardingData.group.startDate||''}" required>
      </div>
      <div class="col-12">
        <label class="form-label">Purpose / Description</label>
        <textarea class="form-control" id="groupDescription" rows="2">${onboardingData.group.description||''}</textarea>
      </div>
      <div class="col-12 d-flex justify-content-between">
        <button type="button" class="btn btn-secondary" onclick="loadOnboardingPage('welcome_group',5)">Skip</button>
        <button type="submit" class="btn btn-primary">Save & Continue</button>
      </div>
    </form>
  `,
  group_activities: ()=>`
    <h4 class="fw-bold text-primary mb-3">Step 2: Select Group Activities</h4>
    <form id="activitiesForm">
      ${["Welfare","Merry-Go-Round","Table Banking","Investment"].map(a=>`
        <div class="form-check">
          <input class="form-check-input" type="checkbox" value="${a}" id="act${a.replace(/\s/g,'')}" ${onboardingData.activities.includes(a)?'checked':''}>
          <label class="form-check-label" for="act${a.replace(/\s/g,'')}">${a}</label>
        </div>
      `).join('')}
      <div class="mt-3 d-flex justify-content-between">
        <button type="button" class="btn btn-secondary" onclick="loadOnboardingPage('group',1)">Back</button>
        <button type="submit" class="btn btn-primary">Save & Continue</button>
      </div>
    </form>
  `,
  bill: ()=>`
    <h4 class="fw-bold text-primary mb-3">Step 3: Billing Setup</h4>
    <form id="billingForm">
      <div class="form-check">
        <input class="form-check-input" type="radio" name="billing" value="Trial" id="trial" ${onboardingData.billing==='Trial'?'checked':''}>
        <label class="form-check-label" for="trial">Trial (Default)</label>
      </div>
      <div class="form-check">
        <input class="form-check-input" type="radio" name="billing" value="Paid" id="paid" ${onboardingData.billing==='Paid'?'checked':''}>
        <label class="form-check-label" for="paid">Paid</label>
      </div>
      <div class="mt-3 d-flex justify-content-between">
        <button type="button" class="btn btn-secondary" onclick="loadOnboardingPage('group_activities',2)">Back</button>
        <button type="submit" class="btn btn-primary">Save & Continue</button>
      </div>
    </form>
  `,
  terms: ()=>`
    <h4 class="fw-bold text-primary mb-3">Step 4: Accept Terms & Conditions</h4>
    <form id="termsForm">
      <div class="form-check">
        <input class="form-check-input" type="checkbox" id="acceptTerms" ${onboardingData.termsAccepted?'checked':''} required>
        <label class="form-check-label" for="acceptTerms">I accept the terms and conditions</label>
      </div>
      <div class="mt-3 d-flex justify-content-between">
        <button type="button" class="btn btn-secondary" onclick="loadOnboardingPage('bill',3)">Back</button>
        <button type="submit" class="btn btn-primary">Finish Onboarding</button>
      </div>
    </form>
  `,
  welcome_group: ()=>`
    <h4 class="fw-bold text-primary mb-3">Welcome to Your Group!</h4>
    <p>You have successfully completed the onboarding process. Start using your group features now.</p>
  `
};

function loadOnboardingPage(page, step=0){
  onboardingIntro.style.display = "none";
  contentContainer.innerHTML = pages[page]();
  stepProgressBar.style.width = `${step*20}%`;
  stepProgressBar.className = 'progress-bar ' + (step<4?'bg-info':(step<5?'bg-warning':'bg-success'));

  if(page==='group'){
    document.getElementById('groupForm').addEventListener('submit', e=>{
      e.preventDefault();
      onboardingData.group = {
        name: document.getElementById('groupName').value,
        type: document.getElementById('groupType').value,
        startDate: document.getElementById('groupStartDate').value,
        description: document.getElementById('groupDescription').value
      };
      loadOnboardingPage('group_activities',2);
    });
  }
  if(page==='group_activities'){
    document.getElementById('activitiesForm').addEventListener('submit', e=>{
      e.preventDefault();
      const checked = [...document.querySelectorAll('#activitiesForm input[type="checkbox"]')].filter(c=>c.checked).map(c=>c.value);
      if(!checked.length){ alert('Select at least one activity'); return; }
      onboardingData.activities = checked;
      loadOnboardingPage('bill',3);
    });
  }
  if(page==='bill'){
    document.getElementById('billingForm').addEventListener('submit', e=>{
      e.preventDefault();
      const billing = document.querySelector('input[name="billing"]:checked').value;
      onboardingData.billing = billing;
      if(billing==='Paid'){ alert('Redirect to payment page'); }
      loadOnboardingPage('terms',4);
    });
  }
  if(page==='terms'){
    document.getElementById('termsForm').addEventListener('submit', e=>{
      e.preventDefault();
      const accepted = document.getElementById('acceptTerms').checked;
      if(!accepted){ alert('Accept terms to continue'); return; }
      onboardingData.termsAccepted = true;
      loadOnboardingPage('welcome_group',5);
    });
  }
}

getStartedBtn.addEventListener('click', ()=>loadOnboardingPage('group',1));
</script>
</body>
</html>
